<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Data Classification Console · SSOT Architect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: dark light;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background:
        radial-gradient(circle at top, #111827, #020617 60%),
        radial-gradient(circle at bottom, #000000, #020617 70%);
      color: #e5e7eb;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .shell {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.75rem;
      box-sizing: border-box;
    }

    .card {
      width: 100%;
      max-width: 1360px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      padding: 1.4rem 1.6rem 1.6rem;
      box-shadow:
        0 22px 60px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(148, 163, 184, 0.45);
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.22), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(236, 72, 153, 0.18), transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(16, 185, 129, 0.12), transparent 55%);
      opacity: 0.95;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .card-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.25rem;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      min-width: 0;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      min-width: 0;
    }

    h1.page-title {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid rgba(248, 250, 252, 0.9);
      padding: 0.18rem 0.6rem;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.96);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
    }

    .tagline {
      margin: 0.1rem 0 0;
      font-size: 0.86rem;
      color: #d1d5db;
      max-width: 780px;
    }

    .meta {
      font-size: 0.76rem;
      color: #9ca3af;
      display: flex;
      flex-wrap: wrap;
      gap: 0.55rem;
      margin-top: 0.1rem;
    }

    .meta span {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .meta-dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.9);
    }

    .main-menu-btn {
      border-radius: 999px;
      border: 1px solid #1f2937;
      padding: 0.4rem 0.95rem;
      font-size: 0.8rem;
      background: #020617;
      color: #9ca3af;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition:
        background 0.12s ease,
        border-color 0.12s ease,
        color 0.12s ease,
        transform 0.06s ease;
      white-space: nowrap;
    }

    .main-menu-btn:hover {
      background: #111827;
      border-color: #2563eb;
      color: #e5e7eb;
      transform: translateY(-1px);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(260px, 280px) minmax(360px, 1.15fr) minmax(360px, 1fr);
      gap: 0.9rem;
      margin-top: 0.3rem;
      align-items: stretch;
    }

    .panel {
      border-radius: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.9));
      padding: 0.7rem 0.85rem;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      min-height: 430px;
    }

    .panel-title {
      margin: 0;
      font-size: 0.95rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.4rem;
    }

    .panel-subtitle {
      margin: 0;
      font-size: 0.78rem;
      color: #9ca3af;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.05rem 0.4rem;
      font-size: 0.65rem;
      border-radius: 999px;
      border: 1px solid rgba(96, 165, 250, 0.8);
      color: #bfdbfe;
      background: rgba(15, 23, 42, 0.96);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      white-space: nowrap;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      margin-top: 0.4rem;
      font-size: 0.8rem;
    }

    .form-group-inline {
      display: flex;
      gap: 0.5rem;
      align-items: flex-end;
    }

    label {
      font-size: 0.78rem;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .label-pill {
      font-size: 0.65rem;
      padding: 0.06rem 0.3rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #9ca3af;
    }

    select,
    input[type="text"],
    textarea {
      border-radius: 0.55rem;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.98);
      color: #e5e7eb;
      font-size: 0.8rem;
      padding: 0.35rem 0.5rem;
      outline: none;
      box-sizing: border-box;
      width: 100%;
    }

    select:focus,
    input[type="text"]:focus,
    textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.7);
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    .small-help {
      font-size: 0.7rem;
      color: #9ca3af;
      margin-top: 0.1rem;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.3rem;
    }

    .chip {
      font-size: 0.7rem;
      border-radius: 999px;
      padding: 0.15rem 0.4rem;
      border: 1px solid rgba(148, 163, 184, 0.85);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
    }

    .chip-primary {
      border-color: rgba(59, 130, 246, 0.9);
      color: #dbeafe;
    }

    .classifications-list {
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
      overflow-y: auto;
      padding-right: 0.1rem;
      margin-top: 0.4rem;
      max-height: 240px;
    }

    .classification-row {
      border-radius: 0.7rem;
      border: 1px solid rgba(55, 65, 81, 0.95);
      background: rgba(15, 23, 42, 0.98);
      padding: 0.4rem 0.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.45rem;
      cursor: pointer;
      transition:
        border-color 0.12s ease,
        background 0.12s ease,
        transform 0.06s ease;
    }

    .classification-row.active {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.7);
      transform: translateY(-1px);
    }

    .classification-info {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      font-size: 0.8rem;
    }

    .classification-name {
      font-weight: 600;
    }

    .classification-meta {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .classification-actions {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .btn-text {
      border-radius: 999px;
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 0.78rem;
      padding: 0.18rem 0.4rem;
      cursor: pointer;
      transition:
        background 0.12s ease,
        color 0.12s ease;
    }

    .btn-text:hover {
      background: rgba(148, 163, 184, 0.2);
      color: #e5e7eb;
    }

    .btn-danger:hover {
      background: rgba(248, 113, 113, 0.12);
      color: #fecaca;
    }

    .add-classification-btn {
      margin-top: 0.4rem;
      border-radius: 999px;
      border: 1px solid rgba(59, 130, 246, 0.9);
      background: rgba(15, 23, 42, 0.98);
      color: #dbeafe;
      padding: 0.32rem 0.7rem;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      cursor: pointer;
      transition:
        background 0.12s ease,
        border-color 0.12s ease,
        transform 0.06s ease;
    }

    .add-classification-btn:hover {
      background: #1d4ed8;
      border-color: #1d4ed8;
      transform: translateY(-1px);
    }

    .config-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 0.2rem;
    }

    .section-label {
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      margin-top: 0.5rem;
      margin-bottom: 0.15rem;
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem 0.4rem;
      margin-top: 0.15rem;
    }

    .checkbox-pill {
      font-size: 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      padding: 0.1rem 0.35rem;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
    }

    .checkbox-pill input {
      margin: 0;
      width: auto;
      accent-color: #2563eb;
    }

    .summary-textarea {
      flex: 1;
      margin-top: 0.4rem;
      border-radius: 0.7rem;
      border: 1px solid rgba(55, 65, 81, 0.95);
      background: rgba(15, 23, 42, 0.98);
      color: #e5e7eb;
      font-size: 0.78rem;
      padding: 0.55rem 0.6rem;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      white-space: pre-wrap;
    }

    .footnote {
      margin-top: 0.4rem;
      font-size: 0.74rem;
      color: #9ca3af;
      text-align: right;
    }

    .btn-ghost {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.98);
      color: #e5e7eb;
      font-size: 0.76rem;
      padding: 0.25rem 0.6rem;
      cursor: pointer;
      margin-left: 0.3rem;
      white-space: nowrap;
      transition:
        background 0.12s ease,
        border-color 0.12s ease,
        transform 0.06s ease;
    }

    .btn-ghost:hover {
      background: #111827;
      border-color: #2563eb;
      transform: translateY(-1px);
    }

    @media (max-width: 1200px) {
      .layout {
        grid-template-columns: minmax(260px, 280px) minmax(320px, 1fr);
        grid-template-rows: auto auto;
        grid-template-areas:
          "context config"
          "summary summary";
      }
      .panel-context { grid-area: context; }
      .panel-config { grid-area: config; }
      .panel-summary { grid-area: summary; min-height: 260px; }
    }

    @media (max-width: 820px) {
      .shell {
        padding: 1.2rem;
      }

      .card {
        padding: 1.1rem 1.1rem 1.3rem;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      h1.page-title {
        font-size: 1.35rem;
      }

      .layout {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto auto auto;
        grid-template-areas:
          "context"
          "config"
          "summary";
      }

      .panel {
        min-height: auto;
      }

      .form-group-inline {
        align-items: stretch;
        flex-direction: column;
      }

      .export-actions {
        justify-content: flex-start !important;
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <div class="card-inner">
        <header>
          <div class="title-block">
            <div class="title-row">
              <h1 class="page-title">
                Data Classification Console · SSOT Architect
              </h1>
              <div class="pill">
                <span class="pill-dot"></span>
                <span>Any Cloud · Any Domain · All Data</span>
              </div>
            </div>
            <p class="tagline">
              Drive your Single Source of Truth from classifications: define sensitivity bands,
              pick data domains, cloud / residency, storage patterns, identity &amp; security baselines —
              then export a blueprint (narrative, JSON, or YAML) you can wire into AWS, Azure, GCP, on-prem, or any mix.
            </p>
            <div class="meta">
              <span><span class="meta-dot"></span> Start from classification → derive cloud choices, SSOT stores, and controls</span>
              <span><span class="meta-dot"></span> Covers data, docs, media, daily work, collaboration, logs, and code</span>
              <span><span class="meta-dot"></span> JSON/YAML export feeds Terraform / Ansible / CI generators</span>
            </div>
          </div>
          <button
            class="main-menu-btn"
            type="button"
            onclick="window.location.href='index.html'">
            ← Main menu
          </button>
        </header>

        <section class="layout">
          <!-- CONTEXT & CLASS LIST -->
          <section class="panel panel-context">
            <h2 class="panel-title">
              Program Context &amp; Classifications
              <span class="badge">Step 1</span>
            </h2>
            <p class="panel-subtitle">
              Define the SSOT program, then add classifications (Public, Internal, PHI, CJIS, PCI, etc.).
              You’ll configure each one on the middle panel.
            </p>

            <div class="form-group">
              <label for="orgName">
                SSOT / Program Name
                <span class="label-pill">e.g. Unified Justice SSOT, Enterprise Records Hub</span>
              </label>
              <input
                id="orgName"
                type="text"
                placeholder="e.g. Unified Court &amp; Evidence SSOT, Enterprise Work &amp; Records Hub" />
            </div>

            <div class="form-group">
              <label for="domainType">
                Primary Domain
              </label>
              <select id="domainType">
                <option value="generic">Generic / Multi-domain</option>
                <option value="courts">Courts &amp; Justice</option>
                <option value="healthcare">Healthcare / PHI</option>
                <option value="financial">Financial / PCI</option>
                <option value="public-sector">Public Sector / Gov / CJIS</option>
                <option value="education">Education</option>
                <option value="enterprise">Enterprise IT / Collaboration</option>
                <option value="custom">Custom</option>
              </select>
            </div>

            <div class="form-group">
              <label for="cloudProvider">
                Global Cloud Posture
              </label>
              <select id="cloudProvider">
                <option value="multi">Multi-cloud / Hybrid</option>
                <option value="aws">Primarily AWS</option>
                <option value="azure">Primarily Azure</option>
                <option value="gcp">Primarily Google Cloud</option>
                <option value="onprem">On-prem / Private Cloud</option>
                <option value="other">Other / Sovereign Cloud</option>
              </select>
              <div class="small-help">
                Each classification can still narrow where it lives (e.g. “regulated can only be Azure Gov or on-prem”).
              </div>
            </div>

            <div class="form-group form-group-inline">
              <div class="form-group" style="flex: 0 0 45%;">
                <label for="newClassName">
                  Classification name
                </label>
                <input
                  id="newClassName"
                  type="text"
                  placeholder="e.g. Public, Internal, Confidential, PHI, CJIS" />
              </div>
              <div class="form-group" style="flex: 0 0 55%;">
                <label for="newClassTier">
                  Sensitivity tier
                </label>
                <select id="newClassTier">
                  <option value="public">Public / Open</option>
                  <option value="internal">Internal / Non-public</option>
                  <option value="confidential">Confidential</option>
                  <option value="regulated">Regulated (PHI/CJIS/PCI/etc.)</option>
                  <option value="restricted">Restricted / Secret</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="newClassExamples">
                Example data types
              </label>
              <input
                id="newClassExamples"
                type="text"
                placeholder="e.g. public reports, PHI records, payment data, daily work docs, calendars, logs" />
            </div>

            <button type="button" class="add-classification-btn" id="addClassificationBtn">
              + Add / Update Classification
            </button>
            <div class="small-help">
              Re-adding with the same name updates the row. Click a row to configure it in detail.
            </div>

            <div class="classifications-list" id="classificationsList">
              <!-- rows injected here -->
            </div>
          </section>

          <!-- CONFIG PANEL -->
          <section class="panel panel-config">
            <h2 class="panel-title">
              Configure Selected Classification
              <span class="badge">Step 2</span>
            </h2>
            <p class="panel-subtitle" id="configSubtitle">
              Select a classification on the left to configure its residency, cloud pattern, data domains,
              storage, identity, tagging, logging, and regulatory tags.
            </p>

            <div class="config-scroll" id="configScroll">
              <!-- dynamic config content -->
            </div>
          </section>

          <!-- SUMMARY PANEL -->
          <section class="panel panel-summary">
            <h2 class="panel-title">
              Generated SSOT Blueprint
              <span class="badge">Step 3</span>
            </h2>
            <p class="panel-subtitle">
              This blueprint text is built from the context and every classification. Switch the export mode
              between a narrative blueprint, raw JSON state, or YAML state for your generators.
            </p>

            <div class="form-group form-group-inline">
              <div class="form-group" style="flex: 0 0 60%;">
                <label for="exportMode">
                  Export format
                </label>
                <select id="exportMode">
                  <option value="narrative">Narrative blueprint (human-readable)</option>
                  <option value="json">JSON state (for generators / IaC)</option>
                  <option value="yaml">YAML state (for generators / IaC)</option>
                </select>
              </div>
              <div class="export-actions" style="flex: 0 0 40%; display:flex; justify-content:flex-end;">
                <button type="button" class="btn-ghost" id="copyExportBtn">Copy export</button>
                <button type="button" class="btn-ghost" id="downloadExportBtn">Download</button>
              </div>
            </div>

            <textarea
              id="blueprintOutput"
              class="summary-textarea"
              readonly></textarea>

            <div class="footnote">
              Treat changes to this blueprint as pull requests in your architecture repo.
            </div>
          </section>
        </section>
      </div>
    </div>
  </div>

  <script>
    const state = {
      context: {
        orgName: "",
        domainType: "generic",
        cloudProvider: "multi"
      },
      classifications: [],
      activeId: null
    };

    let currentExportMode = "narrative";

    const orgNameInput = document.getElementById("orgName");
    const domainTypeSelect = document.getElementById("domainType");
    const cloudProviderSelect = document.getElementById("cloudProvider");
    const newClassNameInput = document.getElementById("newClassName");
    const newClassTierSelect = document.getElementById("newClassTier");
    const newClassExamplesInput = document.getElementById("newClassExamples");
    const addClassificationBtn = document.getElementById("addClassificationBtn");
    const classificationsList = document.getElementById("classificationsList");
    const configScroll = document.getElementById("configScroll");
    const configSubtitle = document.getElementById("configSubtitle");
    const blueprintOutput = document.getElementById("blueprintOutput");
    const exportModeSelect = document.getElementById("exportMode");
    const copyExportBtn = document.getElementById("copyExportBtn");
    const downloadExportBtn = document.getElementById("downloadExportBtn");

    function updateContext() {
      state.context.orgName = orgNameInput.value.trim();
      state.context.domainType = domainTypeSelect.value;
      state.context.cloudProvider = cloudProviderSelect.value;
      renderBlueprint();
    }

    orgNameInput.addEventListener("input", updateContext);
    domainTypeSelect.addEventListener("change", updateContext);
    cloudProviderSelect.addEventListener("change", updateContext);
    exportModeSelect.addEventListener("change", () => {
      currentExportMode = exportModeSelect.value;
      renderBlueprint();
    });

    function tierLabel(tier) {
      switch (tier) {
        case "public": return "Public / Open";
        case "internal": return "Internal / Non-public";
        case "confidential": return "Confidential";
        case "regulated": return "Regulated (PHI/CJIS/PCI/etc.)";
        case "restricted": return "Restricted / Secret";
        default: return tier || "Unspecified tier";
      }
    }

    function upsertClassification(c) {
      const idx = state.classifications.findIndex(x => x.id === c.id);
      if (idx >= 0) {
        state.classifications[idx] = c;
      } else {
        state.classifications.push(c);
      }
    }

    function createEmptyConfigFor(classification) {
      return {
        ...classification,
        residency: "regional",
        cloudPattern: ["Any cloud in global posture"],
        rto: "4h",
        rpo: "1h",
        dataDomains: [],
        storage: [],
        identity: [],
        governance: [],
        logging: [],
        tagKey: "DataClassification",
        taggingScheme: "",
        notes: ""
      };
    }

    function ensureConfigDefaults(c) {
      c.residency = c.residency || "regional";
      c.cloudPattern = c.cloudPattern || ["Any cloud in global posture"];
      c.rto = c.rto || "4h";
      c.rpo = c.rpo || "1h";
      c.dataDomains = c.dataDomains || [];
      c.storage = c.storage || [];
      c.identity = c.identity || [];
      c.governance = c.governance || [];
      c.logging = c.logging || [];
      c.tagKey = c.tagKey || "DataClassification";
      c.taggingScheme = c.taggingScheme || "";
      c.notes = c.notes || "";
      return c;
    }

    function setActive(id) {
      state.activeId = id;
      renderClassificationsList();
      renderClassificationConfig();
      renderBlueprint();
    }

    function deleteClassification(id) {
      state.classifications = state.classifications.filter(c => c.id !== id);
      if (state.activeId === id) {
        state.activeId = state.classifications[0]?.id ?? null;
      }
      renderClassificationsList();
      renderClassificationConfig();
      renderBlueprint();
    }

    function renderClassificationsList() {
      classificationsList.innerHTML = "";
      if (state.classifications.length === 0) {
        const msg = document.createElement("div");
        msg.className = "small-help";
        msg.textContent = "No classifications yet. Add at least Public / Internal / Confidential / Regulated to start.";
        classificationsList.appendChild(msg);
        return;
      }

      state.classifications.forEach(c => {
        const row = document.createElement("div");
        row.className = "classification-row";
        if (c.id === state.activeId) row.classList.add("active");

        const info = document.createElement("div");
        info.className = "classification-info";

        const nameSpan = document.createElement("div");
        nameSpan.className = "classification-name";
        nameSpan.textContent = c.name || "(Unnamed)";

        const metaSpan = document.createElement("div");
        metaSpan.className = "classification-meta";
        const tierText = tierLabel(c.tier);
        const ex = c.examples ? ` · ${c.examples}` : "";
        metaSpan.textContent = `${tierText}${ex}`;

        info.appendChild(nameSpan);
        info.appendChild(metaSpan);

        const actions = document.createElement("div");
        actions.className = "classification-actions";

        const editBtn = document.createElement("button");
        editBtn.type = "button";
        editBtn.className = "btn-text";
        editBtn.textContent = "Edit";
        editBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          setActive(c.id);
        });

        const delBtn = document.createElement("button");
        delBtn.type = "button";
        delBtn.className = "btn-text btn-danger";
        delBtn.textContent = "Remove";
        delBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          deleteClassification(c.id);
        });

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        row.appendChild(info);
        row.appendChild(actions);
        row.addEventListener("click", () => setActive(c.id));

        classificationsList.appendChild(row);
      });
    }

    function createCheckboxGroup(options, selectedList, onChange) {
      const container = document.createElement("div");
      container.className = "checkbox-group";
      options.forEach(label => {
        const pill = document.createElement("label");
        pill.className = "checkbox-pill";
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = selectedList.includes(label);
        checkbox.addEventListener("change", () => {
          let updated = [...selectedList];
          if (checkbox.checked) {
            if (!updated.includes(label)) updated.push(label);
          } else {
            updated = updated.filter(v => v !== label);
          }
          onChange(updated);
        });
        const span = document.createElement("span");
        span.textContent = label;

        pill.appendChild(checkbox);
        pill.appendChild(span);
        container.appendChild(pill);
      });
      return container;
    }

    function renderClassificationConfig() {
      configScroll.innerHTML = "";
      const active = state.classifications.find(c => c.id === state.activeId);
      if (!active) {
        configSubtitle.textContent = "Select a classification on the left to configure its SSOT behavior.";
        const msg = document.createElement("div");
        msg.className = "small-help";
        msg.textContent = "Each classification gets its own residency, cloud, storage, identity, tagging, logging, and governance profile.";
        configScroll.appendChild(msg);
        return;
      }
      configSubtitle.textContent = `Configuring: ${active.name} (${tierLabel(active.tier)})`;

      ensureConfigDefaults(active);

      // Residency + RTO/RPO
      const residencyLabel = document.createElement("div");
      residencyLabel.className = "section-label";
      residencyLabel.textContent = "Residency & Availability";

      const residencyRow = document.createElement("div");
      residencyRow.className = "form-group form-group-inline";

      const residencyGroup = document.createElement("div");
      residencyGroup.className = "form-group";
      residencyGroup.style.flex = "0 0 45%";
      const resLabel = document.createElement("label");
      resLabel.textContent = "Data residency / sovereignty";
      const resSelect = document.createElement("select");
      [
        { value: "global", label: "Global / multi-region allowed" },
        { value: "regional", label: "Regional (single cloud region)" },
        { value: "country", label: "Country-only / sovereign boundary" },
        { value: "onprem", label: "On-prem / air-gapped / sovereign cloud only" }
      ].forEach(o => {
        const opt = document.createElement("option");
        opt.value = o.value;
        opt.textContent = o.label;
        resSelect.appendChild(opt);
      });
      resSelect.value = active.residency || "regional";
      resSelect.addEventListener("change", () => {
        active.residency = resSelect.value;
        upsertClassification(active);
        renderBlueprint();
      });
      residencyGroup.appendChild(resLabel);
      residencyGroup.appendChild(resSelect);

      const rtoGroup = document.createElement("div");
      rtoGroup.className = "form-group";
      rtoGroup.style.flex = "0 0 27.5%";
      const rtoLabelEl = document.createElement("label");
      rtoLabelEl.textContent = "RTO tier";
      const rtoSelect = document.createElement("select");
      [
        { value: "none", label: "No formal SLA" },
        { value: "24h", label: "≤ 24 hours" },
        { value: "4h", label: "≤ 4 hours" },
        { value: "1h", label: "≤ 1 hour" },
        { value: "15m", label: "≤ 15 minutes" },
        { value: "nearzero", label: "Near-zero (active-active)" }
      ].forEach(o => {
        const opt = document.createElement("option");
        opt.value = o.value;
        opt.textContent = o.label;
        rtoSelect.appendChild(opt);
      });
      rtoSelect.value = active.rto || "4h";
      rtoSelect.addEventListener("change", () => {
        active.rto = rtoSelect.value;
        upsertClassification(active);
        renderBlueprint();
      });
      rtoGroup.appendChild(rtoLabelEl);
      rtoGroup.appendChild(rtoSelect);

      const rpoGroup = document.createElement("div");
      rpoGroup.className = "form-group";
      rpoGroup.style.flex = "0 0 27.5%";
      const rpoLabelEl = document.createElement("label");
      rpoLabelEl.textContent = "RPO tier";
      const rpoSelect = document.createElement("select");
      [
        { value: "24h", label: "≤ 24 hours" },
        { value: "4h", label: "≤ 4 hours" },
        { value: "1h", label: "≤ 1 hour" },
        { value: "15m", label: "≤ 15 minutes" },
        { value: "zero", label: "Zero data loss" }
      ].forEach(o => {
        const opt = document.createElement("option");
        opt.value = o.value;
        opt.textContent = o.label;
        rpoSelect.appendChild(opt);
      });
      rpoSelect.value = active.rpo || "1h";
      rpoSelect.addEventListener("change", () => {
        active.rpo = rpoSelect.value;
        upsertClassification(active);
        renderBlueprint();
      });
      rpoGroup.appendChild(rpoLabelEl);
      rpoGroup.appendChild(rpoSelect);

      residencyRow.appendChild(residencyGroup);
      residencyRow.appendChild(rtoGroup);
      residencyRow.appendChild(rpoGroup);

      configScroll.appendChild(residencyLabel);
      configScroll.appendChild(residencyRow);

      // Cloud pattern
      const cloudLabel = document.createElement("div");
      cloudLabel.className = "section-label";
      cloudLabel.textContent = "Cloud pattern for this classification";

      const cloudOptions = [
        "Any cloud in global posture",
        "AWS only",
        "Azure only",
        "Google Cloud only",
        "On-prem only",
        "AWS + Azure",
        "AWS + GCP",
        "Azure + GCP",
        "Hybrid (cloud + on-prem)"
      ];
      const cloudGroup = createCheckboxGroup(
        cloudOptions,
        active.cloudPattern || [],
        (updated) => {
          active.cloudPattern = updated.length ? updated : ["Any cloud in global posture"];
          upsertClassification(active);
          renderBlueprint();
          renderClassificationConfig();
        }
      );

      configScroll.appendChild(cloudLabel);
      configScroll.appendChild(cloudGroup);

      // Data domains
      const domainLabel = document.createElement("div");
      domainLabel.className = "section-label";
      domainLabel.textContent = "Data & workload domains this classification covers";

      const dataDomainOptions = [
        "Structured application data (transactions / master data)",
        "Documents & files (PDFs, docs, spreadsheets, images)",
        "Media & evidence (photos, video, audio, recordings)",
        "Daily work artifacts (calendars, schedules, task boards)",
        "Collaboration content (email, chat, shared docs/sites)",
        "Analytics, warehouse, lakehouse datasets",
        "Logs, metrics, traces, security events",
        "Source code, IaC, pipelines",
        "Configuration & reference data",
        "User profiles, identities, and device state"
      ];
      const dataDomainGroup = createCheckboxGroup(
        dataDomainOptions,
        active.dataDomains || [],
        (updated) => {
          active.dataDomains = updated;
          upsertClassification(active);
          renderBlueprint();
        }
      );

      configScroll.appendChild(domainLabel);
      configScroll.appendChild(dataDomainGroup);

      // Storage patterns
      const storageLabel = document.createElement("div");
      storageLabel.className = "section-label";
      storageLabel.textContent = "Permitted SSOT storage patterns";

      const storageOptions = [
        "Object storage with versioning & lifecycle",
        "Relational DB (managed or self-hosted)",
        "NoSQL / key-value / document DB",
        "File shares / NAS with snapshots",
        "Data warehouse (columnar)",
        "Data lake / lakehouse",
        "Search index / full-text engine",
        "WORM / immutable storage",
        "External system of record (SaaS / legacy)",
        "In-memory cache (supporting, not SSOT)"
      ];
      const storageGroup = createCheckboxGroup(
        storageOptions,
        active.storage || [],
        (updated) => {
          active.storage = updated;
          upsertClassification(active);
          renderBlueprint();
        }
      );

      configScroll.appendChild(storageLabel);
      configScroll.appendChild(storageGroup);

      // Identity & access
      const identityLabel = document.createElement("div");
      identityLabel.className = "section-label";
      identityLabel.textContent = "Identity, access & device posture requirements";

      const identityOptions = [
        "Enterprise IdP (AD / Entra ID / Cloud Identity / Okta)",
        "SSO required (SAML/OIDC) – no local accounts",
        "Per-classification RBAC groups & roles",
        "Hardware keys / phishing-resistant MFA",
        "Conditional access / context-aware access",
        "Device compliance required (managed endpoints only)",
        "Just-in-time elevation / break-glass accounts",
        "Privileged access workstation for admin tasks"
      ];
      const identityGroup = createCheckboxGroup(
        identityOptions,
        active.identity || [],
        (updated) => {
          active.identity = updated;
          upsertClassification(active);
          renderBlueprint();
        }
      );

      configScroll.appendChild(identityLabel);
      configScroll.appendChild(identityGroup);

      // Governance & regs
      const govLabel = document.createElement("div");
      govLabel.className = "section-label";
      govLabel.textContent = "Regulatory & governance tags (what frameworks apply)";

      const governanceOptions = [
        "No specific external regulation",
        "HIPAA / PHI",
        "CJIS",
        "PCI-DSS",
        "GDPR / data protection",
        "FedRAMP / NIST 800-53 style controls",
        "SOC 2",
        "ITAR / export-controlled",
        "Local / state privacy law",
        "Internal-only classification policy"
      ];
      const governanceGroup = createCheckboxGroup(
        governanceOptions,
        active.governance || [],
        (updated) => {
          active.governance = updated;
          upsertClassification(active);
          renderBlueprint();
        }
      );

      configScroll.appendChild(govLabel);
      configScroll.appendChild(governanceGroup);

      // Tagging scheme for records
      const taggingLabel = document.createElement("div");
      taggingLabel.className = "section-label";
      taggingLabel.textContent = "Tagging / label scheme for individual records";

      const taggingGroup = document.createElement("div");
      taggingGroup.className = "form-group";
      const taggingTextarea = document.createElement("textarea");
      taggingTextarea.value = active.taggingScheme || "";
      taggingTextarea.placeholder = "e.g.\n- Required tags: court_id, case_number, record_type, sensitivity_level\n- Optional tags: judge_id, agency_id, evidence_type, warrant_type\n- ABAC rules: sensitivity_level + court_id drive access; evidence_type controls which teams see media.";
      taggingTextarea.addEventListener("input", () => {
        active.taggingScheme = taggingTextarea.value;
        upsertClassification(active);
        renderBlueprint();
      });
      taggingGroup.appendChild(taggingTextarea);

      configScroll.appendChild(taggingLabel);
      configScroll.appendChild(taggingGroup);

      // Cloud tag key name
      const tagKeyGroup = document.createElement("div");
      tagKeyGroup.className = "form-group";
      const tagKeyLabel = document.createElement("label");
      tagKeyLabel.textContent = "Cloud tag / label key name (AWS / Azure / GCP)";
      const tagKeyInput = document.createElement("input");
      tagKeyInput.type = "text";
      tagKeyInput.value = active.tagKey || "DataClassification";
      tagKeyInput.placeholder = "e.g. DataClassification, info_class, security_level";
      tagKeyInput.addEventListener("input", () => {
        active.tagKey = tagKeyInput.value.trim() || "DataClassification";
        upsertClassification(active);
        renderBlueprint();
      });
      const tagKeyHelp = document.createElement("div");
      tagKeyHelp.className = "small-help";
      tagKeyHelp.textContent = "This is the tag key / label name you will use on cloud resources. The value is usually this classification’s name (e.g. Confidential, PHI, CJIS).";

      tagKeyGroup.appendChild(tagKeyLabel);
      tagKeyGroup.appendChild(tagKeyInput);
      tagKeyGroup.appendChild(tagKeyHelp);
      configScroll.appendChild(tagKeyGroup);

      // Logging & audit
      const logLabel = document.createElement("div");
      logLabel.className = "section-label";
      logLabel.textContent = "Logging, audit & retention expectations";

      const loggingOptions = [
        "Basic access logging",
        "Verbose access logging (read/write/metadata)",
        "Admin & config changes logged",
        "Security events forwarded to SIEM",
        "Tamper-evident audit trail",
        "Long-term archive for investigations",
        "Per-classification retention policies",
        "Legal hold support",
        "Near real-time alerting on violations"
      ];
      const loggingGroup = createCheckboxGroup(
        loggingOptions,
        active.logging || [],
        (updated) => {
          active.logging = updated;
          upsertClassification(active);
          renderBlueprint();
        }
      );

      configScroll.appendChild(logLabel);
      configScroll.appendChild(loggingGroup);

      // Notes
      const notesGroup = document.createElement("div");
      notesGroup.className = "form-group";
      const notesLabel = document.createElement("label");
      notesLabel.textContent = "Notes / special constraints for this classification";
      const notesTextarea = document.createElement("textarea");
      notesTextarea.value = active.notes || "";
      notesTextarea.placeholder = "e.g. 'CJIS workloads only allowed on specific regions/tenants', 'PHI must never be exported to vendor X', 'Highly restricted logs only visible to team Y'.";
      notesTextarea.addEventListener("input", () => {
        active.notes = notesTextarea.value;
        upsertClassification(active);
        renderBlueprint();
      });

      notesGroup.appendChild(notesLabel);
      notesGroup.appendChild(notesTextarea);
      configScroll.appendChild(notesGroup);
    }

    function mapDomainType(domainType) {
      switch (domainType) {
        case "courts": return "Courts & Justice";
        case "healthcare": return "Healthcare / PHI";
        case "financial": return "Financial / Payments";
        case "public-sector": return "Public Sector / Government / CJIS";
        case "education": return "Education";
        case "enterprise": return "Enterprise IT / Collaboration";
        case "custom": return "Custom domain";
        default: return "Multi-domain / generic workloads";
      }
    }

    function mapCloudProvider(cloudProvider) {
      switch (cloudProvider) {
        case "aws": return "Primarily AWS";
        case "azure": return "Primarily Microsoft Azure";
        case "gcp": return "Primarily Google Cloud";
        case "onprem": return "On-prem / private cloud primary";
        case "other": return "Other / sovereign cloud primary";
        default: return "Multi-cloud / hybrid posture";
      }
    }

    function mapResidency(res) {
      switch (res) {
        case "global": return "Global / multi-region allowed.";
        case "regional": return "Confined to a single cloud region, with regional HA.";
        case "country": return "Must remain within specific country / sovereignty boundaries.";
        case "onprem": return "On-premises / sovereign cloud only.";
        default: return "Residency not specified.";
      }
    }

    function mapRto(rto) {
      switch (rto) {
        case "none": return "No formal Recovery Time Objective (RTO).";
        case "24h": return "RTO ≤ 24 hours.";
        case "4h": return "RTO ≤ 4 hours.";
        case "1h": return "RTO ≤ 1 hour.";
        case "15m": return "RTO ≤ 15 minutes.";
        case "nearzero": return "Near-zero RTO via active-active or equivalent.";
        default: return "RTO not specified.";
      }
    }

    function mapRpo(rpo) {
      switch (rpo) {
        case "24h": return "RPO ≤ 24 hours.";
        case "4h": return "RPO ≤ 4 hours.";
        case "1h": return "RPO ≤ 1 hour.";
        case "15m": return "RPO ≤ 15 minutes.";
        case "zero": return "Zero data loss (synchronous replication).";
        default: return "RPO not specified.";
      }
    }

    function toYaml(value, indentLevel = 0) {
      const indent = "  ".repeat(indentLevel);
      const nextIndent = "  ".repeat(indentLevel + 1);

      function scalar(v) {
        if (v === null || v === undefined) return "null";
        if (typeof v === "number" || typeof v === "boolean") return String(v);
        // stringify string safely
        return JSON.stringify(String(v));
      }

      if (Array.isArray(value)) {
        if (value.length === 0) return "[]";
        let out = "";
        value.forEach(item => {
          if (item && typeof item === "object") {
            out += `${indent}-\n${toYaml(item, indentLevel + 1)}`;
          } else {
            out += `${indent}- ${scalar(item)}\n`;
          }
        });
        return out;
      }

      if (value && typeof value === "object") {
        const keys = Object.keys(value);
        if (keys.length === 0) return "{}\n";
        let out = "";
        keys.forEach(key => {
          const v = value[key];
          if (v && typeof v === "object") {
            const isEmptyObj = !Array.isArray(v) && Object.keys(v).length === 0;
            const isEmptyArr = Array.isArray(v) && v.length === 0;
            if (isEmptyObj) {
              out += `${indent}${key}: {}\n`;
            } else if (isEmptyArr) {
              out += `${indent}${key}: []\n`;
            } else {
              out += `${indent}${key}:\n${toYaml(v, indentLevel + 1)}`;
            }
          } else {
            out += `${indent}${key}: ${scalar(v)}\n`;
          }
        });
        return out;
      }

      return `${indent}${scalar(value)}\n`;
    }

    function getExportPayload() {
      return {
        context: { ...state.context },
        classifications: state.classifications.map(c => ensureConfigDefaults({ ...c }))
      };
    }

    function getExportFilename() {
      const baseRaw = state.context.orgName || "ssot-classifications";
      const base = baseRaw
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "") || "ssot-classifications";

      const ext =
        currentExportMode === "json"
          ? ".json"
          : currentExportMode === "yaml"
            ? ".yaml"
            : ".txt";

      return base + ext;
    }

    function renderBlueprint() {
      const ctx = state.context;
      const name = ctx.orgName || "Single Source of Truth (SSOT)";
      const domainLabel = mapDomainType(ctx.domainType);
      const cloudLabel = mapCloudProvider(ctx.cloudProvider);

      if (currentExportMode === "json") {
        const jsonPayload = getExportPayload();
        blueprintOutput.value = JSON.stringify(jsonPayload, null, 2);
        return;
      }

      if (currentExportMode === "yaml") {
        const jsonPayload = getExportPayload();
        blueprintOutput.value = toYaml(jsonPayload);
        return;
      }

      // Narrative export
      let out = "";

      out += `${name} – Classification-First SSOT Blueprint\n`;
      out += `============================================================\n\n`;
      out += `Context\n`;
      out += `-------\n`;
      out += `Domain focus : ${domainLabel}\n`;
      out += `Global posture: ${cloudLabel}\n\n`;

      out += `Design intent:\n`;
      out += `- Single Source of Truth (SSOT) is defined by classification.\n`;
      out += `- For each classification, we fix: residency, cloud pattern, data domains, storage patterns, identity & access,\n`;
      out += `  tagging / labels, logging/audit, and regulatory tags.\n`;
      out += `- Individual systems (apps, lakes, DMS, collaboration suites) inherit their requirements from the classification\n`;
      out += `  of the data they host.\n\n`;

      if (state.classifications.length === 0) {
        out += `No classifications defined yet.\n`;
        out += `Add Public/Internal/Confidential/Regulated/etc. on the left, then configure each.\n`;
        blueprintOutput.value = out;
        return;
      }

      out += `Classification Profiles\n`;
      out += `----------------------\n\n`;

      state.classifications.forEach((c, idx) => {
        ensureConfigDefaults(c);
        out += `${idx + 1}. Classification: ${c.name}\n`;
        out += `   Tier          : ${tierLabel(c.tier)}\n`;
        if (c.examples) out += `   Example data  : ${c.examples}\n`;

        out += `\n   Residency & Availability\n`;
        out += `   -----------------------\n`;
        out += `   - Residency: ${mapResidency(c.residency)}\n`;
        out += `   - ${mapRto(c.rto)}\n`;
        out += `   - ${mapRpo(c.rpo)}\n`;

        out += `\n   Cloud Pattern for This Classification\n`;
        out += `   ------------------------------------\n`;
        if (c.cloudPattern && c.cloudPattern.length) {
          c.cloudPattern.forEach(p => {
            out += `   - ${p}\n`;
          });
        } else {
          out += `   - Follows global program posture (${cloudLabel}).\n`;
        }

        out += `\n   Data & Workload Domains Included\n`;
        out += `   --------------------------------\n`;
        if (c.dataDomains && c.dataDomains.length) {
          c.dataDomains.forEach(d => {
            out += `   - ${d}\n`;
          });
        } else {
          out += `   - (No domains specified yet.)\n`;
        }

        out += `\n   Permitted SSOT Storage Patterns\n`;
        out += `   ------------------------------\n`;
        if (c.storage && c.storage.length) {
          c.storage.forEach(s => {
            out += `   - ${s}\n`;
          });
        } else {
          out += `   - (Storage patterns not yet selected.)\n`;
        }

        out += `\n   Identity, Access & Device Posture\n`;
        out += `   --------------------------------\n`;
        if (c.identity && c.identity.length) {
          c.identity.forEach(id => {
            out += `   - ${id}\n`;
          });
        } else {
          out += `   - (Identity / access baseline not yet selected.)\n`;
        }

        out += `\n   Regulatory & Governance Tags\n`;
        out += `   ---------------------------\n`;
        if (c.governance && c.governance.length) {
          c.governance.forEach(g => {
            out += `   - ${g}\n`;
          });
        } else {
          out += `   - (No specific regulatory tags selected.)\n`;
        }

        out += `\n   Cloud Resource Tagging\n`;
        out += `   ----------------------\n`;
        out += `   - Tag key (recommended): ${c.tagKey || "DataClassification"}\n`;
        out += `   - Suggested tag value for this classification: ${c.name}\n`;
        out += `   - Apply consistently across storage, databases, analytics, queues/topics, and integration services.\n`;

        if (c.taggingScheme && c.taggingScheme.trim()) {
          out += `\n   Tagging / Label Scheme for Records\n`;
          out += `   -----------------------------------\n`;
          out += `   ${c.taggingScheme.trim().split("\n").map(line => "   " + line).join("\n")}\n`;
        }

        out += `\n   Logging, Audit & Retention\n`;
        out += `   -------------------------\n`;
        if (c.logging && c.logging.length) {
          c.logging.forEach(l => {
            out += `   - ${l}\n`;
          });
        } else {
          out += `   - (Logging / audit expectations not yet specified.)\n`;
        }

        if (c.notes && c.notes.trim()) {
          out += `\n   Special Notes / Constraints\n`;
          out += `   --------------------------\n`;
          out += `   ${c.notes.trim().split("\n").map(line => "   " + line).join("\n")}\n`;
        }

        out += `\n`;
      });

      out += `Implementation Guidance\n`;
      out += `----------------------\n`;
      out += `- For each classification, map:\n`;
      out += `  * To concrete cloud services (buckets, DBs, warehouses, collaboration tenants) in AWS/Azure/GCP/on-prem.\n`;
      out += `  * To Terraform (providers, modules, policies) and Ansible (roles, playbooks) for repeatable provisioning.\n`;
      out += `  * To IAM groups/roles and conditional access policies in your IdP.\n`;
      out += `  * To observability / SIEM pipelines for logging and alerts.\n`;
      out += `  * To a consistent cloud tag / label key (e.g. DataClassification) whose value is this classification’s name.\n`;
      out += `- All SSOT systems must declare which classification(s) they host and comply with that profile.\n`;
      out += `- Changes to classifications should be rare, governed, and go through architecture / security review.\n`;

      blueprintOutput.value = out;
    }

    addClassificationBtn.addEventListener("click", () => {
      const name = newClassNameInput.value.trim();
      if (!name) {
        alert("Please enter a classification name.");
        return;
      }
      const tier = newClassTierSelect.value;
      const examples = newClassExamplesInput.value.trim();

      const existing = state.classifications.find(
        c => c.name.toLowerCase() === name.toLowerCase()
      );
      let id = existing ? existing.id : `cls-${Date.now()}-${Math.random().toString(16).slice(2)}`;

      const base = existing
        ? { ...existing, name, tier, examples }
        : createEmptyConfigFor({ id, name, tier, examples });

      const cfg = ensureConfigDefaults(base);
      upsertClassification(cfg);

      if (!state.activeId) state.activeId = cfg.id;
      renderClassificationsList();
      renderClassificationConfig();
      renderBlueprint();
    });

    function initDefaults() {
      const defaults = [
        {
          id: "cls-public",
          name: "Public",
          tier: "public",
          examples: "Public web content, open data, marketing materials.",
          residency: "global",
          cloudPattern: ["Any cloud in global posture"],
          rto: "none",
          rpo: "24h",
          dataDomains: ["Documents & files (PDFs, docs, spreadsheets, images)", "Analytics, warehouse, lakehouse datasets"],
          storage: ["Object storage with versioning & lifecycle", "File shares / NAS with snapshots"],
          identity: ["Enterprise IdP (AD / Entra ID / Cloud Identity / Okta)", "SSO required (SAML/OIDC) – no local accounts"],
          governance: ["No specific external regulation"],
          logging: ["Basic access logging", "Admin & config changes logged"],
          tagKey: "DataClassification",
          taggingScheme: "",
          notes: ""
        },
        {
          id: "cls-internal",
          name: "Internal",
          tier: "internal",
          examples: "Daily work docs, calendars, internal reports, collaboration content.",
          residency: "regional",
          cloudPattern: ["Any cloud in global posture", "Hybrid (cloud + on-prem)"],
          rto: "24h",
          rpo: "4h",
          dataDomains: [
            "Documents & files (PDFs, docs, spreadsheets, images)",
            "Daily work artifacts (calendars, schedules, task boards)",
            "Collaboration content (email, chat, shared docs/sites)",
            "Analytics, warehouse, lakehouse datasets",
            "Logs, metrics, traces, security events"
          ],
          storage: [
            "Object storage with versioning & lifecycle",
            "Relational DB (managed or self-hosted)",
            "Data warehouse (columnar)",
            "Search index / full-text engine"
          ],
          identity: [
            "Enterprise IdP (AD / Entra ID / Cloud Identity / Okta)",
            "SSO required (SAML/OIDC) – no local accounts",
            "Per-classification RBAC groups & roles",
            "Strict IAM & least privilege"
          ],
          governance: ["Internal-only classification policy"],
          logging: [
            "Verbose access logging (read/write/metadata)",
            "Admin & config changes logged",
            "Security events forwarded to SIEM",
            "Per-classification retention policies"
          ],
          tagKey: "DataClassification",
          taggingScheme: "",
          notes: ""
        }
      ];

      state.classifications = defaults.map(c => ensureConfigDefaults(c));
      state.activeId = state.classifications[0]?.id ?? null;
      renderClassificationsList();
      renderClassificationConfig();
      renderBlueprint();
    }

    copyExportBtn.addEventListener("click", () => {
      const text = blueprintOutput.value || "";
      if (!navigator.clipboard) {
        alert("Clipboard API not available in this browser.");
        return;
      }
      navigator.clipboard.writeText(text).catch(() => {
        alert("Could not copy to clipboard.");
      });
    });

    downloadExportBtn.addEventListener("click", () => {
      const text = blueprintOutput.value || "";
      const filename = getExportFilename();
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    initDefaults();
  </script>
</body>
</html>
