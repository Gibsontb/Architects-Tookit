<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Terraform Encyclopedia · Architect's Toolkit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: dark;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #1a2735, #050608 60%);
      color: #f5f5f5;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .shell {
      flex: 1;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 2rem;
      box-sizing: border-box;
    }

    .card {
      width: 100%;
      max-width: 1100px;
      background: rgba(0, 0, 0, 0.55);
      border-radius: 16px;
      padding: 1.25rem 1.5rem 1.5rem;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.65);
      border: 1px solid rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(14px);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 0.25rem;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      min-width: 0;
    }

    h1.page-title {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 600;
      outline: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    h1.page-title[contenteditable="true"] {
      cursor: text;
    }

    .page-title-hint {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .main-menu-btn {
      border-radius: 999px;
      border: 1px solid #1f2937;
      padding: 0.35rem 0.95rem;
      font-size: 0.78rem;
      background: #020617;
      color: #9ca3af;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      transition:
        background 0.12s ease,
        border-color 0.12s ease,
        color 0.12s ease,
        transform 0.05s ease;
      white-space: nowrap;
    }

    .main-menu-btn:hover {
      background: #111827;
      border-color: #2563eb;
      color: #e5e7eb;
      transform: translateY(-1px);
    }

    .workspace {
      flex: 1;
      margin-top: 0.25rem;
      border-radius: 0.9rem;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      padding: 0;
      font-size: 0.9rem;
      color: #e5e7eb;
      display: flex;
      align-items: stretch;
      justify-content: stretch;
      min-height: 480px;
      box-sizing: border-box;
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.14), transparent 55%);
      overflow: hidden;
    }

    .footer-note {
      margin-top: 0.5rem;
      font-size: 0.78rem;
      color: #9ca3af;
      text-align: right;
    }

    .tf-layout {
      display: flex;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
    }

    .tf-nav {
      width: 230px;
      min-width: 200px;
      max-width: 260px;
      border-right: 1px solid rgba(148, 163, 184, 0.35);
      padding: 1rem;
      box-sizing: border-box;
      backdrop-filter: blur(18px);
      background: linear-gradient(180deg, rgba(15,23,42,0.7), rgba(15,23,42,0.35));
      overflow-y: auto;
    }

    .tf-nav h2 {
      margin: 0 0 0.4rem 0;
      font-size: 1rem;
      font-weight: 600;
    }

    .tf-nav p {
      margin: 0 0 0.75rem 0;
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .tf-nav-section-label {
      margin-top: 0.7rem;
      margin-bottom: 0.25rem;
      font-size: 0.72rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #6b7280;
    }

    .tf-nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      font-size: 0.83rem;
    }

    .tf-nav li {
      margin: 0;
    }

    .tf-nav a {
      color: #cbd5f5;
      text-decoration: none;
      display: block;
      padding: 0.22rem 0.4rem;
      border-radius: 999px;
      transition: background 0.12s ease, color 0.12s ease, transform 0.04s ease;
    }

    .tf-nav a:hover {
      background: rgba(37, 99, 235, 0.25);
      color: #eff6ff;
      transform: translateX(1px);
    }

    .tf-content {
      flex: 1;
      padding: 1rem 1.25rem 1rem;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .tf-section {
      margin-bottom: 1.6rem;
      padding-bottom: 1.1rem;
      border-bottom: 1px dashed rgba(148, 163, 184, 0.4);
    }

    .tf-section:last-of-type {
      border-bottom: none;
      margin-bottom: 0.2rem;
      padding-bottom: 0.2rem;
    }

    .tf-section-header {
      display: flex;
      align-items: baseline;
      gap: 0.4rem;
      margin-bottom: 0.25rem;
    }

    .tf-section-header h2 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .tf-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.05rem 0.4rem;
      font-size: 0.65rem;
      border-radius: 999px;
      border: 1px solid rgba(96,165,250,0.7);
      color: #bfdbfe;
      background: rgba(15,23,42,0.9);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      white-space: nowrap;
    }

    .tf-tagline {
      font-size: 0.85rem;
      color: #9ca3af;
      margin: 0.35rem 0 0.5rem;
    }

    .tf-columns {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      gap: 1.1rem;
    }

    .tf-list {
      margin: 0.35rem 0 0.2rem;
      padding-left: 1.1rem;
      font-size: 0.82rem;
    }

    .tf-list li {
      margin-bottom: 0.12rem;
    }

    .tf-code {
      margin-top: 0.4rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.78rem;
      background: #020617;
      border-radius: 0.6rem;
      padding: 0.55rem 0.65rem;
      border: 1px solid rgba(31, 41, 55, 0.9);
      overflow-x: auto;
      line-height: 1.35;
    }

    .tf-code code {
      white-space: pre;
    }

    .tf-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      margin-top: 0.45rem;
      border-radius: 0.6rem;
      overflow: hidden;
    }

    .tf-table thead {
      background: rgba(15,23,42, 0.9);
    }

    .tf-table th,
    .tf-table td {
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 0.35rem 0.45rem;
      text-align: left;
    }

    .tf-table th {
      font-weight: 600;
      color: #e5e7eb;
    }

    .tf-table td {
      color: #d1d5db;
    }

    .tf-pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.4rem;
    }

    .tf-pill {
      padding: 0.12rem 0.48rem;
      border-radius: 999px;
      font-size: 0.72rem;
      border: 1px solid rgba(156, 163, 175, 0.7);
      color: #e5e7eb;
      white-space: nowrap;
    }

    .tf-pill--primary {
      border-color: rgba(59,130,246,0.9);
      color: #dbeafe;
    }

    .tf-note {
      font-size: 0.76rem;
      color: #9ca3af;
      margin-top: 0.4rem;
    }

    input,
    select,
    textarea {
      font-family: inherit;
    }

    @media (max-width: 900px) {
      .tf-layout {
        flex-direction: column;
      }
      .tf-nav {
        width: 100%;
        max-width: 100%;
        border-right: none;
        border-bottom: 1px solid rgba(148, 163, 184, 0.35);
      }
    }

    @media (max-width: 700px) {
      .shell {
        padding: 1.25rem;
      }
      .card {
        padding: 1rem 1rem 1.25rem;
      }
      header {
        align-items: flex-start;
        flex-direction: column;
      }
      .footer-note {
        text-align: left;
      }
      .tf-columns {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <header>
        <div class="title-block">
          <h1 class="page-title" contenteditable="true" spellcheck="false">
            Terraform Encyclopedia · Architect's Toolkit
          </h1>
          <div class="page-title-hint">
            Rename this page to match a specific cloud, app, or project.
          </div>
        </div>
        <button
          class="main-menu-btn"
          type="button"
          onclick="window.location.href='index.html'">
          ← Main menu
        </button>
      </header>

      <section class="workspace">
        <div class="tf-layout">
          <nav class="tf-nav">
            <h2>Terraform Encyclopedia</h2>
            <p>Language, backends, patterns – plus exportable manifests per stack.</p>

            <div class="tf-nav-section-label">Core Language</div>
            <ul>
              <li><a href="#tf-overview">1. Overview & Mental Model</a></li>
              <li><a href="#tf-blocks">2. Core Blocks</a></li>
              <li><a href="#tf-vars">3. Variables & Types</a></li>
              <li><a href="#tf-state">4. State & Backends</a></li>
            </ul>

            <div class="tf-nav-section-label">Architecture Use-Cases</div>
            <ul>
              <li><a href="#tf-modules">5. Modules & Reuse</a></li>
              <li><a href="#tf-workflows">6. Workflows & CI/CD</a></li>
              <li><a href="#tf-usecases">7. Quick Use-Case Index</a></li>
            </ul>

            <div class="tf-nav-section-label">Exports</div>
            <ul>
              <li><a href="#tf-exports">8. Architect Export Helper</a></li>
            </ul>
          </nav>

          <main class="tf-content">
            <!-- 1. OVERVIEW -->
            <section id="tf-overview" class="tf-section">
              <div class="tf-section-header">
                <h2>1. Overview & Mental Model</h2>
                <span class="tf-badge">Model</span>
              </div>
              <p class="tf-tagline">
                Terraform is the <strong>source of truth for cloud resources</strong>. It reads desired state (HCL),
                compares with real state, and applies a plan.
              </p>

              <div class="tf-columns">
                <div>
                  <ul class="tf-list">
                    <li>Describe infra as code (HCL modules, variables, outputs).</li>
                    <li>Use backends for shared state (S3, GCS, AzureRM, remote).</li>
                    <li>Use modules for patterns (landing zones, VPCs, app stacks).</li>
                  </ul>
                </div>
                <div>
                  <div class="tf-code">
                    <code>terraform {
  required_version = "&gt;= 1.5.0"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~&gt; 5.0"
    }
  }
}</code>
                  </div>
                </div>
              </div>
            </section>

            <!-- 2. BLOCKS -->
            <section id="tf-blocks" class="tf-section">
              <div class="tf-section-header">
                <h2>2. Core Blocks</h2>
                <span class="tf-badge">Language</span>
              </div>

              <div class="tf-columns">
                <div>
                  <ul class="tf-list">
                    <li><code>terraform</code> – version, backend, providers.</li>
                    <li><code>provider</code> – cloud provider credentials / region.</li>
                    <li><code>resource</code> – create/update a single infra object.</li>
                    <li><code>module</code> – reuse group of resources.</li>
                    <li><code>data</code> – read-only lookup.</li>
                  </ul>
                </div>
                <div>
                  <div class="tf-code">
                    <code>resource "aws_s3_bucket" "logs" {
  bucket = "ccoe-logs-${var.env}"

  tags = {
    env                = var.env
    data_classification = "P2"
  }
}</code>
                  </div>
                </div>
              </div>
            </section>

            <!-- 3. VARS -->
            <section id="tf-vars" class="tf-section">
              <div class="tf-section-header">
                <h2>3. Variables & Types</h2>
                <span class="tf-badge">Input</span>
              </div>

              <div class="tf-columns">
                <div>
                  <ul class="tf-list">
                    <li>Use strongly-typed variables for safety.</li>
                    <li>Group environment and classification attributes.</li>
                  </ul>
                </div>
                <div>
                  <div class="tf-code">
                    <code>variable "env" {
  type        = string
  description = "Environment name"
}

variable "data_profile" {
  type = object({
    classification = string
    rto_hours      = number
    rpo_minutes    = number
  })
}</code>
                  </div>
                </div>
              </div>
            </section>

            <!-- 4. STATE -->
            <section id="tf-state" class="tf-section">
              <div class="tf-section-header">
                <h2>4. State & Backends</h2>
                <span class="tf-badge">State</span>
              </div>
              <p class="tf-tagline">
                State is where Terraform remembers what it created. The backend defines how that state is stored and locked.
              </p>

              <div class="tf-columns">
                <div>
                  <h3 style="margin:0 0 0.2rem;">4.1 Backend Example (AWS)</h3>
                  <div class="tf-code">
                    <code>terraform {
  backend "s3" {
    bucket         = "ccoe-tfstate"
    key            = "courts/landing-zone/prod.tfstate"
    region         = "us-east-1"
    dynamodb_table = "tf-locks"
    encrypt        = true
  }
}</code>
                  </div>
                </div>
                <div>
                  <h3 style="margin:0 0 0.2rem;">4.2 Backend Types</h3>
                  <ul class="tf-list">
                    <li><strong>S3</strong> – AWS; use DynamoDB for locks.</li>
                    <li><strong>GCS</strong> – GCP; object-level locking via GCS.</li>
                    <li><strong>AzureRM</strong> – Azure storage accounts.</li>
                    <li><strong>remote</strong> – Terraform Cloud / Enterprise.</li>
                  </ul>
                </div>
              </div>
            </section>

            <!-- 5. MODULES -->
            <section id="tf-modules" class="tf-section">
              <div class="tf-section-header">
                <h2>5. Modules & Reuse</h2>
                <span class="tf-badge">Patterns</span>
              </div>

              <div class="tf-columns">
                <div>
                  <div class="tf-code">
                    <code>module "court_landing_zone" {
  source = "git::https://git.example.com/ccoe/landing-zone.git//modules/court"

  env = var.env

  data_profile = {
    classification = "CJIS"
    rto_hours      = 1
    rpo_minutes    = 15
  }
}</code>
                  </div>
                </div>
                <div>
                  <ul class="tf-list">
                    <li>Modules are the building blocks of your patterns catalog.</li>
                    <li>Tie module inputs back to your classification model.</li>
                  </ul>
                </div>
              </div>
            </section>

            <!-- 6. WORKFLOWS -->
            <section id="tf-workflows" class="tf-section">
              <div class="tf-section-header">
                <h2>6. Workflows, Environments & CI/CD</h2>
                <span class="tf-badge">Lifecycle</span>
              </div>
              <p class="tf-tagline">
                Terraform is most powerful when wrapped in a <strong>standard pipeline</strong> and environment layout.
              </p>

              <div class="tf-columns">
                <div>
                  <h3>6.1 Core Commands</h3>
                  <ul class="tf-list">
                    <li><code>terraform init</code> – install providers, configure backend.</li>
                    <li><code>terraform validate</code> – syntax and static checks.</li>
                    <li><code>terraform plan</code> – diff between desired vs. current.</li>
                    <li><code>terraform apply</code> – execute plan.</li>
                    <li><code>terraform destroy</code> – teardown.</li>
                  </ul>
                  <div class="tf-code">
                    <code># Typical pipeline skeleton
terraform fmt       # normalize style
terraform validate  # static checks
terraform plan -out plan.bin
terraform apply plan.bin</code>
                  </div>
                </div>
                <div>
                  <h3>6.2 Environments</h3>
                  <ul class="tf-list">
                    <li>Folders per environment (<code>envs/dev</code>, <code>envs/prod</code>) with separate backends.</li>
                    <li>Workspaces if you need shared config but multiple states.</li>
                  </ul>
                </div>
              </div>
            </section>

            <!-- 7. USECASE INDEX -->
            <section id="tf-usecases" class="tf-section">
              <div class="tf-section-header">
                <h2>7. Quick Use-Case Index</h2>
                <span class="tf-badge">Cheat Sheet</span>
              </div>

              <table class="tf-table">
                <thead>
                  <tr>
                    <th>Task</th>
                    <th>Blocks</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Landing zone for courts</td>
                    <td><code>module</code> LZ, <code>for_each</code> per account/project.</td>
                    <td>Outputs feed Ansible inventory & tags.</td>
                  </tr>
                  <tr>
                    <td>Evidence storage bucket</td>
                    <td><code>resource</code> bucket + policy + KMS.</td>
                    <td>Classification & residency from data profile.</td>
                  </tr>
                  <tr>
                    <td>Networking for multi-region</td>
                    <td>Transit gateway / hub-spoke modules.</td>
                    <td>Document patterns in <code>single-source-of-truth.html</code>.</td>
                  </tr>
                </tbody>
              </table>
            </section>

            <!-- 8. EXPORTS -->
            <section id="tf-exports" class="tf-section">
              <div class="tf-section-header">
                <h2>8. Architect Export Helper (Terraform)</h2>
                <span class="tf-badge">Exports</span>
              </div>
              <p class="tf-tagline">
                Convert a stack definition (classification + environment + tags + backend) into
                <strong>JSON manifests, HCL skeletons, or YAML</strong> you can commit to Git.
              </p>

              <div class="tf-columns">
                <div>
                  <h3>8.1 Input – Describe the stack</h3>

                  <dl style="display:grid;grid-template-columns:max-content minmax(0,1fr);gap:0.18rem 0.6rem;font-size:0.8rem;margin:0.4rem 0;">
                    <dt>Stack / module name</dt>
                    <dd>
                      <input
                        id="tfExpStackName"
                        type="text"
                        placeholder="e.g. courts_cjis_ssot"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      />
                    </dd>

                    <dt>Environment</dt>
                    <dd>
                      <input
                        id="tfExpEnvironment"
                        type="text"
                        placeholder="e.g. dev, test, prod"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      />
                    </dd>

                    <dt>Cloud / platform</dt>
                    <dd>
                      <select
                        id="tfExpCloudTarget"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      >
                        <option value="">Select platform…</option>
                        <option value="aws">AWS</option>
                        <option value="azure">Azure</option>
                        <option value="gcp">Google Cloud</option>
                        <option value="multi">Multi-cloud</option>
                        <option value="onprem">On-prem / VMware</option>
                        <option value="other">Other / generic</option>
                      </select>
                    </dd>

                    <dt>Primary region / location</dt>
                    <dd>
                      <input
                        id="tfExpRegion"
                        type="text"
                        placeholder="e.g. us-east-1, us-central1, eastus2, onprem-dc1"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      />
                    </dd>

                    <dt>Backend type</dt>
                    <dd>
                      <select
                        id="tfExpBackendType"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      >
                        <option value="">Select backend…</option>
                        <option value="s3">AWS S3</option>
                        <option value="gcs">GCS</option>
                        <option value="azurerm">AzureRM</option>
                        <option value="remote">Terraform Cloud / remote</option>
                        <option value="local">Local (not for prod)</option>
                      </select>
                    </dd>

                    <dt>Backend bucket / container</dt>
                    <dd>
                      <input
                        id="tfExpBackendBucket"
                        type="text"
                        placeholder="e.g. ccoe-tf-state"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      />
                    </dd>

                    <dt>Backend key / prefix</dt>
                    <dd>
                      <input
                        id="tfExpBackendKey"
                        type="text"
                        placeholder="e.g. courts/cjis/ssot/terraform.tfstate"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      />
                    </dd>

                    <dt>Classification name</dt>
                    <dd>
                      <input
                        id="tfExpClassification"
                        type="text"
                        placeholder="e.g. CJIS, PHI, Internal"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      />
                    </dd>

                    <dt>Residency / region set</dt>
                    <dd>
                      <input
                        id="tfExpResidency"
                        type="text"
                        placeholder="e.g. US-only, EU-only, multi-region US/EU"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      />
                    </dd>

                    <dt>SLA / RTO / RPO</dt>
                    <dd>
                      <input
                        id="tfExpSla"
                        type="text"
                        placeholder="e.g. 99.9% uptime, RTO 1h, RPO 15m"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      />
                    </dd>

                    <dt>Tag namespace / style</dt>
                    <dd>
                      <input
                        id="tfExpTagNamespace"
                        type="text"
                        placeholder="aws: tags; gcp: labels; azure: tags"
                        style="width:100%;padding:0.25rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;"
                      />
                    </dd>

                    <dt>Tag set (key=value, one per line)</dt>
                    <dd>
                      <textarea
                        id="tfExpTags"
                        placeholder="env=prod&#10;data_classification=CJIS&#10;system=court_case_mgmt"
                        style="width:100%;min-height:80px;padding:0.3rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;resize:vertical;"
                      ></textarea>
                    </dd>

                    <dt>Notes / constraints</dt>
                    <dd>
                      <textarea
                        id="tfExpNotes"
                        placeholder="e.g. Domains allowed, CJIS isolation, cross-region replication rules."
                        style="width:100%;min-height:70px;padding:0.3rem 0.4rem;border-radius:0.45rem;border:1px solid rgba(75,85,99,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;box-sizing:border-box;resize:vertical;"
                      ></textarea>
                    </dd>
                  </dl>

                  <p class="tf-note">
                    Pull classification, residency, and RTO/RPO directly from <code>data-classification.html</code>.
                  </p>
                </div>

                <div>
                  <h3>8.2 Output – JSON / HCL / YAML</h3>

                  <div class="tf-pill-row">
                    <span class="tf-pill tf-pill--primary">JSON manifest</span>
                    <span class="tf-pill">Terraform HCL skeleton</span>
                    <span class="tf-pill">YAML (for catalogs)</span>
                  </div>

                  <div style="margin-top:0.6rem;">
                    <div style="font-size:0.78rem;color:#d1d5db;margin-bottom:0.2rem;">Output format</div>
                    <div style="display:flex;flex-wrap:wrap;gap:0.45rem;font-size:0.78rem;">
                      <label style="display:inline-flex;align-items:center;gap:0.25rem;cursor:pointer;">
                        <input type="radio" name="tfExpFormat" value="json" checked /> JSON
                      </label>
                      <label style="display:inline-flex;align-items:center;gap:0.25rem;cursor:pointer;">
                        <input type="radio" name="tfExpFormat" value="hcl" /> HCL skeleton
                      </label>
                      <label style="display:inline-flex;align-items:center;gap:0.25rem;cursor:pointer;">
                        <input type="radio" name="tfExpFormat" value="yaml" /> YAML
                      </label>
                    </div>
                  </div>

                  <div style="margin-top:0.6rem;display:flex;flex-wrap:wrap;gap:0.4rem;">
                    <button
                      type="button"
                      onclick="window.tfExportGenerate()"
                      style="border-radius:999px;border:1px solid rgba(59,130,246,0.9);background:#1d4ed8;color:#e5e7eb;font-size:0.8rem;padding:0.3rem 0.9rem;cursor:pointer;"
                    >
                      Generate
                    </button>
                    <button
                      type="button"
                      onclick="window.tfExportCopy()"
                      style="border-radius:999px;border:1px solid rgba(148,163,184,0.9);background:#020617;color:#e5e7eb;font-size:0.8rem;padding:0.3rem 0.9rem;cursor:pointer;"
                    >
                      Copy to clipboard
                    </button>
                  </div>

                  <textarea
                    id="tfExportOutput"
                    readonly
                    placeholder="Generated export will appear here."
                    style="margin-top:0.6rem;width:100%;min-height:230px;padding:0.4rem 0.5rem;border-radius:0.6rem;border:1px solid rgba(55,65,81,0.95);background:#020617;color:#e5e7eb;font-size:0.78rem;box-sizing:border-box;resize:vertical;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;"
                  ></textarea>

                  <p class="tf-note">
                    Check this into <code>arch/terraform-manifests/</code> or similar. These manifests tie directly
                    back to the single source of truth for data and classifications.
                  </p>
                </div>
              </div>
            </section>
          </main>
        </div>
      </section>

      <div class="footer-note">
        Save as <code>terraform.html</code> next to <code>index.html</code>. Use it as the canonical Terraform reference.
      </div>
    </div>
  </div>

  <script>
    (function () {
      function parseTags(raw) {
        if (!raw) return {};
        const lines = raw.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
        const out = {};
        for (const line of lines) {
          const idx = line.indexOf("=");
          if (idx === -1) {
            out[line] = "";
          } else {
            const k = line.slice(0, idx).trim();
            const v = line.slice(idx + 1).trim();
            if (k) out[k] = v;
          }
        }
        return out;
      }

      function getFormat() {
        const nodes = document.querySelectorAll('input[name="tfExpFormat"]');
        for (const n of nodes) {
          if (n.checked) return n.value;
        }
        return "json";
      }

      function buildManifest() {
        const stack = document.getElementById("tfExpStackName").value.trim();
        const env = document.getElementById("tfExpEnvironment").value.trim();
        const cloud = document.getElementById("tfExpCloudTarget").value.trim();
        const region = document.getElementById("tfExpRegion").value.trim();
        const backendType = document.getElementById("tfExpBackendType").value.trim();
        const backendBucket = document.getElementById("tfExpBackendBucket").value.trim();
        const backendKey = document.getElementById("tfExpBackendKey").value.trim();
        const classification = document.getElementById("tfExpClassification").value.trim();
        const residency = document.getElementById("tfExpResidency").value.trim();
        const sla = document.getElementById("tfExpSla").value.trim();
        const tagNamespace = document.getElementById("tfExpTagNamespace").value.trim();
        const tagsRaw = document.getElementById("tfExpTags").value.trim();
        const notes = document.getElementById("tfExpNotes").value.trim();

        return {
          kind: "terraform_stack_manifest",
          version: "v1",
          stack_name: stack,
          metadata: {
            environment: env,
            cloud_target: cloud,
            region: region,
            classification_name: classification,
            residency: residency,
            sla_rto_rpo: sla,
            tag_namespace: tagNamespace,
            generated_at: new Date().toISOString()
          },
          backend: {
            type: backendType,
            bucket_or_container: backendBucket,
            key_or_prefix: backendKey
          },
          tags: parseTags(tagsRaw),
          notes: notes
        };
      }

      function toYaml(obj, indent) {
        indent = indent || "";
        if (obj === null || obj === undefined) return "null";
        if (typeof obj === "string" || typeof obj === "number" || typeof obj === "boolean") {
          if (typeof obj === "string" && /[:#\-?{},[\]&*!|>'"%@`]/.test(obj)) {
            return JSON.stringify(obj);
          }
          return String(obj);
        }
        if (Array.isArray(obj)) {
          if (obj.length === 0) return "[]";
          return obj
            .map(v => indent + "- " + toYaml(v, indent + "  ").replace(/^\s+/, ""))
            .join("\n");
        }
        const keys = Object.keys(obj);
        if (keys.length === 0) return "{}";
        return keys
          .map(k => {
            const v = obj[k];
            if (v === null || v === undefined) return indent + k + ": null";
            if (typeof v === "object") {
              const nested = toYaml(v, indent + "  ");
              if (nested.indexOf("\n") === -1) {
                return indent + k + ": " + nested;
              }
              return indent + k + ":\n" + nested;
            }
            return indent + k + ": " + toYaml(v, indent + "  ");
          })
          .join("\n");
      }

      function toHcl(manifest) {
        const m = manifest;
        const tagsLines = [];
        const tags = manifest.tags || {};
        for (const k of Object.keys(tags)) {
          const v = tags[k];
          tagsLines.push(`    ${k} = "${String(v).replace(/"/g, '\\"')}"`);
        }
        const tagsBlock = tagsLines.length ? "\n  tags = {\n" + tagsLines.join("\n") + "\n  }\n" : "";

        let backendBlock = "";
        if (m.backend.type) {
          backendBlock = `terraform {
  backend "${m.backend.type}" {
    bucket = "${m.backend.bucket_or_container || ""}"
    key    = "${m.backend.key_or_prefix || ""}"
  }
}\n\n`;
        }

        return `${backendBlock}module "${m.stack_name || "stack"}" {
  source = "./modules/${m.stack_name || "stack"}"

  env  = "${m.metadata.environment || ""}"
  region = "${m.metadata.region || ""}"

  data_profile = {
    classification = "${m.metadata.classification_name || ""}"
    residency      = "${m.metadata.residency || ""}"
    sla_rto_rpo    = "${(m.metadata.sla_rto_rpo || "").replace(/"/g, '\\"')}"
  }${tagsBlock}}`;
      }

      window.tfExportGenerate = function () {
        const outEl = document.getElementById("tfExportOutput");
        if (!outEl) return;
        const manifest = buildManifest();
        const fmt = getFormat();
        let text = "";

        if (fmt === "json") {
          text = JSON.stringify(manifest, null, 2);
        } else if (fmt === "yaml") {
          text = toYaml(manifest);
        } else if (fmt === "hcl") {
          text = toHcl(manifest);
        } else {
          text = JSON.stringify(manifest, null, 2);
        }

        outEl.value = text;
      };

      window.tfExportCopy = function () {
        const outEl = document.getElementById("tfExportOutput");
        if (!outEl || !outEl.value) return;
        try {
          outEl.select();
          document.execCommand("copy");
        } catch (e) {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(outEl.value);
          }
        }
      };
    })();
  </script>
</body>
</html>
